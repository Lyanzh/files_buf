一、I2C驱动体系  
虽然I2C硬件体系结构和协议都很容易理解，但是Linux I2C驱动体系结构却有相当的复杂度，它主要由3部分组成，即**I2C设备驱动**、**I2C总线驱动**和**I2C核心**。

1. I2C核心  
	I2C核心是I2c总线和I2c设备驱动的中间枢纽，它以通用的、与平台无关的接口实现了I2C中设备与适配器的沟通，提供了I2C总线驱动和设备驱动的注册、注销方法，I2C通信方法（即“algorithm”）上层的、与具体适配器无关的代码以及探测设备、检测设备的地址的上层代码等。I2c总线驱动填充I2c_adapter和I2c_algorithm结构体，I2c设备驱动填充I2c_driver和i2c_client结构体并实现其本身所对应设备类型的驱动。

2. I2C总线驱动  
	I2C总线驱动是对I2C硬件体系结构中适配器的实现，适配器可由CPU控制，甚至可以直接集成在CPU内部。  
	I2C总线驱动主要包含了I2C适配器数据结构i2c_adapter、I2C适配器的algorithm数据结构i2c_algorithm和控制I2C适配器产生通信信号的函数。  
	经由I2C总线驱动的代码，我们可以控制I2C适配器以主控制方式产生开始、停止位、读写周期，以及以从设备方式读写、产生ACK等。

3. I2C设备驱动  
	I2C设备驱动（也称为客户端驱动）是对I2C硬件体系结构中设备端的实现，设备一般挂接在受CPU控制的I2C适配器上，通过I2C适配器与CPU交换数据。  
	I2C设备驱动主要包含了数据结构体i2c_driver和i2c_client，我们需要具体设备实现其中的成员函数。

	![I2C驱动体系结构图1](https://i.imgur.com/sPuyWQg.jpg)
	I2C驱动体系结构图1

	![I2C驱动体系结构图2](https://i.imgur.com/iz5KB5j.jpg)
	I2C驱动体系结构图2

	另外，系统中i2c-dev.c文件定义的主设备号为89的设备可以方便地给应用程序提供读写I2c设备寄存器的能力，使得工程师大多数时候并不需要为具体的I2c设备驱动定义文件操作接口。  
	如何理解adapter和client呢？它在s3c2440中对应的是什么？Adapter和client都是linux驱动软件抽象出来的东西，Linux I2C框架搞那么复杂是为了通用性及为了符合Linux内核驱动模式而制定的。简单的说，你的开发板上有几个I2C接口，就有几个adapter , 也就是有几条I2C bus ， I2C client对应的就是你的外围I2C 设备，有几个就有几个client , 把这些设备插入开发板， 对应其中的一条bus, 那么相应的就对应了其中的一个adapter , 接下来的就是I2c核心部分使client与 adapter匹配成对。  
	在linux内核中，所有的I2C设备都在sysfs文件系统中显示，存在于/sys/bus/i2c/目录下，适配器地址和芯片地址的形式列出，例如：

		1. [fulinux@ubuntu linux-3.0]$ tree /sys/bus/i2c/       
		2. /sys/bus/i2c/
		3. |-- devices
		4. |   |-- i2c-0 -> ../../../devices/pci0000:00/0000:00:02.0/i2c-0
		5. |   |-- i2c-1 -> ../../../devices/pci0000:00/0000:00:02.0/i2c-1
		6. |   |-- i2c-2 -> ../../../devices/pci0000:00/0000:00:02.0/i2c-2
		7. |   |-- i2c-3 -> ../../../devices/pci0000:00/0000:00:02.0/i2c-3
		8. |   |-- i2c-4 -> ../../../devices/pci0000:00/0000:00:02.0/i2c-4
		9. |   |-- i2c-5 -> ../../../devices/pci0000:00/0000:00:02.0/i2c-5
		10. |   |-- i2c-6 -> ../../../devices/pci0000:00/0000:00:02.0/drm/card0/card0-DP-1/i2c-6
		11. |   `-- i2c-7 -> ../../../devices/pci0000:00/0000:00:02.0/drm/card0/card0-DP-2/i2c-7
		12. |-- drivers
		13. |   |-- 88PM860x
		14. |   |   |-- bind
		15. |   |   |-- uevent
		16. |   |   `-- unbind
		17. |   |-- aat2870
		18. |   |   |-- bind
		19. |   |   |-- uevent
		20. |   |   `-- unbind
		21. |   |-- ab3100
		22. |   |   |-- bind
		23. |   |   |-- uevent
		24. |   |   `-- unbind
		25. |   |-- adp5520

