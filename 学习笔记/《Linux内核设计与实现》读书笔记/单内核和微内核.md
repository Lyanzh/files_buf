# 单内核和微内核 #


## 术语定义 ##

### 单内核（Monolithic kernel） ###

单内核也叫集中式操作系统。整个系统是一个大模块，可以被分为若干逻辑模块，即处理器管理、存储器管理、设备管理和文件管理，其模块间的交互是通过直接调用其他模块中的函数实现的。

单内核模型以提高系统执行效率为设计理念，因为整个系统是一个统一的内核，所以其内部调用效率很高。

单内核的缺点也正是由于其源代码是一个整体而造成的，通常各模块之间的界限并不特别清晰，模块间的调用比较随意，所以进行系统修改或升级时，往往“牵一发而动全身”，导致工作量加大，使其难于维护。

单内核操作系统的典型例子是，大部分Linux，包括BSD在内的几乎所有的Unix，MS-DOS，Windows 9x。例如Sun Solaris的内核就运行着数百个线程以实现各种功能，而编译过Linux内核的人就知道Linux内核有数十MB之巨。

### 微内核（Micro kernel） ###

微内核是指把操作系统结构中的内存管理、设备管理、文件系统等高级服务功能尽可能地从内核中分离出来，变成几个独立的非内核模块，而在内核只保留少量最基本的功能，使内核变得简洁可靠，因此叫微内核。

微内核实现的基础是操作系统理论层面的逻辑功能划分。几大功能模块在理论上是相互独立的，形成比较明显的界限，其优点如下：

- 充分的模块化，可独立更换任一模块而不会影响其他模块，从而方便第三方开发、设计模块。

- 未被使用的模块功能不必运行，因而能大幅度减少系统的内存需求。

- 具有很高的可移植性，理论上讲只需要单独对各微内核部分进行移植修改即可。由于微内核的体积通常很小，而且互不影响，因此工作量很小。

微内核操作系统的典型例子是，Mach（一个非原生的分布式操作系统内核，被众多操作系统采用，例如，被应用在Mac OS X上）、IBM AIX、BeOS，以及Windows NT（Windows Server 2003和Windows Server 2008都包含其内），还有著名的Minix（一个主要用于教学的Unix系统）和Amoeba（一个真正原生的分布式操作系统）。

### 总结 ###

|    | 原理 | 优势 | 劣势 |
| -- | --- | --- | ---- |
| 单内核 | 整个内核都在一个大内核地址空间上运行 | 1. 简单；<br>2. 高效：所有内核都在一个大的地址空间上，所以内核各个功能之间的调用和调用函数类似，几乎没有性能开销 |一个功能的崩溃会导致整个内核无法使用|
| 微内核 | 内核按功能被划分成各个独立的过程，每个过程独立的运行在自己的地址空间上 | 安全：内核的各种服务独立运行，一种服务挂了不会影响其他服务 | 内核各个服务之间的调用涉及进程间的通信，比较复杂且效率低|

### 优劣之争 ###

单内核和微内核哪个更好显然是一个很有争议性的问题，必须说明的很有趣的一点是，这种争论经常会令人想到上一个时代CPU领域中RISC和CISC的斗争。

现代的成功CPU设计中都包含了任何的这两种技术，就像现在Linux（单内核）和Windows NT（微内核）实际上都是微内核和单内核的混合产物一样，只是或多或少的问题而已。

历史上有过这样的争论，Linux（单内核）的作者Linus和Minix/Amoeba（均为微内核）的作者Andrew S. Tanenbaum教授在讨论组上论战，并卷入了大量的爱好者。最终Linus也同意Tanenbaum微内核架构更为先进的论点。

## Linux内核的特点 ##

Linux的内核虽然是基于单内核的，但是经过这么多年的发展，也具备微内核的一些特征。（体现了Linux实用至上的原则）

Linux内核与传统的Unix系统之间的一些显著差异：

- **Linux支持动态加载内核模块**。尽管Linux内核也是单内核，可是允许在需要的时候动态地卸除和加载部分内核代码。
- **Linux支持对称多处理（SMP）机制**，尽管许多Unix的变体也支持SMP，但传统的Unix并不支持这种机制。
- **Linux内核可以抢占（preemptive）**。与传统的Unix不同，Linux内核具有允许在内核运行的任务优先执行的能力。在其他各种Unix产品中，只有Solaris和IRIX支持抢占，但是大多数传统的Unix内核不支持抢占。
- **Linux内核并不区分线程和其他的一般进程**。对于内核来说，所有的进程都一样—只不过其中的一些共享资源而已。
- Linux提供具有设备类的面向对象的设备模型、热插拔事件，以及用户空间的设备文件系统（sysfs）。
- Linux忽略了一些被认为是设计得很拙劣的Unix特性，像STREAMS，它还忽略了那些实际上已经根本不会使用的过时标准。
- Linux体现了自由这个词的精髓。

